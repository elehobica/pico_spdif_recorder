# Spotify Metadata Extractor Skill

## Overview
This skill automatically extracts track listings (song titles and durations) from Spotify and generates YAML files suitable for ID3 tagging of WAV files.

## Trigger Phrases
Apply this skill when the user uses phrases like:

- "Get Spotify metadata for [Album Name] by [Artist Name]"
- "Extract track info from Spotify for [Album Name] to YAML"
- "Fetch [Album Name] track list from Spotify"
- "Create YAML file from Spotify data for [Album Name]"

## Workflow

### Step 1: Spotify Search
```
web_search: "[Album Name] [Artist Name] site:open.spotify.com track"
```

- Select any track URL from search results
- Track pages contain the full album tracklist (up to 50 tracks)

### Step 2: Track Page Retrieval and Artist Information Extraction
```
web_fetch: https://open.spotify.com/track/[TRACK_ID]
```

- Extract track information from the page:
  - Track title
  - Duration in MM:SS format
  - **Artist name for each track** (as displayed on Spotify page)
  - Album-wide artist name

- **Artist Information Processing**:
  1. Identify the album artist (from album information at top of page)
  2. Check artist for each track (displayed in tracklist for each song)
  3. Record individually only when track artist ≠ album artist

### Step 3: Multi-Page Support
For albums with 50+ tracks:
- Search for additional track pages containing later tracks
- Retrieve similarly using web_fetch
- Consolidate all track information

### Step 4: YAML File Generation
Create YAML file in the following format:

```yaml
album: "Album Name"
artist: "Artist Name"
year: YYYY
genre: "Genre"
tracks:
  - title: "Song Title 1"
    time: "M:SS"
    track-number: 1
  - title: "Song Title 2"
    time: "M:SS"
    track-number: 2
    artist: "Guest Artist"  # Only when different from album artist
```

### Step 5: File Saving
```
/mnt/user-data/outputs/[album_name]_spotify_metadata.yaml
```

Filename generation rules:
- Convert album name to snake_case
- Remove special characters
- Example: "Rad Gumbo: The Complete..." → "rad_gumbo_spotify_metadata.yaml"

## Important Notes

### Artist Information Handling
- **Automatic Detection**: Extract artist information for each track from Spotify track page
- **Album Artist Comparison**: 
  - Add individual `artist` field only when track artist differs from album artist
  - Omit when same (inherits album-wide artist)
- **Format Examples**:
  - Featuring/with notation: `artist: "Little Feat, Linda Ronstadt"`
  - Multiple artists: `artist: "Artist1, Artist2"`
  - Guest vocals: Use information as it appears in track name or artist field

### Time Format
- Spotify uses "M:SS" or "MM:SS" format
- Record as-is in YAML (no need to convert to seconds)

### Track Numbers
- Number sequentially from 1
- Ignore actual disc numbers within album (use continuous numbering)

### Error Handling
- When search results not found: Confirm with user
- When track information incomplete: Ask user rather than using estimated values

## Output Example

After execution, report results as follows:

```
✓ Retrieved metadata for [Album Name] from Spotify

**Retrieved Information:**
- Album: [Album Name]
- Artist: [Artist Name]  
- Track Count: XX tracks
- File: album_name_spotify_metadata.yaml

[Present YAML file using present_files tool]
```

## Integration with WAV Tagger

YAML files generated by this skill can be used directly with:
```bash
python wav_tagger.py album_name_spotify_metadata.yaml /path/to/wav/files/ --tolerance 7
```

The `--tolerance` parameter (in seconds) is specified at runtime, not in the YAML file.

## Examples

### Example 1: Basic Usage
**User:** "Get Spotify metadata for Dixie Chicken by Little Feat"

**Actions:**
1. web_search: "Dixie Chicken Little Feat site:open.spotify.com track"
2. web_fetch: Track URL from search results
3. Extract track information (10 songs)
4. Generate dixie_chicken_spotify_metadata.yaml
5. present_files

### Example 2: Large Album
**User:** "Create YAML from Spotify data for Rad Gumbo Complete Warner Bros Years"

**Actions:**
1. Retrieve 50 tracks from first track page
2. Search and retrieve later track pages
3. Consolidate all 157 tracks
4. Generate rad_gumbo_spotify_metadata.yaml
5. present_files

### Example 3: Automatic Artist Detection
**User:** "Get Spotify metadata for The Last Record Album"

**Actions:**
1. Retrieve track information
2. Automatically check artist for each track
3. Detect "All That You Dream" artist as "Little Feat, Linda Ronstadt"
4. Automatically add to relevant track since it differs from album artist "Little Feat":
   ```yaml
   - title: "All That You Dream"
     time: "3:33"
     track-number: 2
     artist: "Little Feat, Linda Ronstadt"
   ```
5. Generate YAML
6. present_files

## Technical Details

### Artist Detection Implementation
Method for obtaining artist information on Spotify track pages:

**HTML Pattern 1 - Within Tracklist:**
```html
<a href="/track/xxx">Song Title
Artist Name</a>
```

**HTML Pattern 2 - Individual Notation:**
```
Song Title
Artist1, Artist2
Duration
```

**Processing Logic:**
```python
# 1. Get album artist
album_artist = extract_from_album_header()

# 2. Check artist for each track
for track in tracks:
    track_artist = extract_track_artist(track)
    
    # 3. Add only when different
    if track_artist != album_artist:
        track['artist'] = track_artist
```

### Python Script Integration
This skill integrates with the following Python script:
- `/home/claude/wav_tagger.py` - ID3 tagging tool

### File Locations
- Working directory: `/home/claude` (temporary files)
- Output directory: `/mnt/user-data/outputs` (final files)

### Dependencies
- web_search tool
- web_fetch tool
- Python 3 (for YAML generation)
- bash (for file operations)

## Version History
- v1.0 (2026-01-28): Initial release
- v1.1 (2026-01-28): Added automatic artist detection
- v1.2 (2026-01-29): Translated to English for international sharing
- v1.3 (2026-01-29): Removed tolerance-seconds from YAML (now command-line parameter)
